<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <meta name="description" content="List of items and bids.">
  <title>{{.Title}} - Bids</title>
  <link rel="stylesheet" href="/pico.min.css">
  <link rel="stylesheet" href="/gobid.css">
  <script src="/bids.js" defer></script>
</head>

<body>
  <header class="app-header">
    <nav class="container" aria-label="Primary navigation">
      <ul>
        <li><a href="/"><strong>{{.Title}}</strong></a></li>
      </ul>
      <ul>
        {{if .User.Username}}
        <li><a href="/logout">Logout {{.User.Username}}</a></li>
        {{else}}
        <li><a href="/login?r=/bids">Login</a></li>
        {{end}}
      </ul>
    </nav>
  </header>

  <main class="container-fluid">
    <h1 class="text-center">{{.Title}} Items and Bids</h1>

    {{if .User.Username}}
    <nav aria-label="Bids controls" class="container-fluid">
      <ul></ul>
      <ul>
        <li>
          <button type="button" id="toggleAll"
            class="secondary"
            aria-expanded="false"
            aria-controls="bidsTable"
            title="Shortcut: Press E to expand all, C to collapse all"
          >
            Expand all bids
          </button>
        </li>
      </ul>
    </nav>

    <table class="striped">
      <caption>List of all items with their bids</caption>
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Item</th>
          <th scope="col"data-align="right">Opening</th>
          <th scope="col" data-align="right">Increment</th>
          <th scope="col" data-align="center">Bids</th>
        </tr>
      </thead>

      {{range .Items}}
      <tbody class="item">
        <tr>
          <td>{{.ID}}</td>
          <td>{{.Title}}<br>{{.Artist}}</td>
          <td data-align="right">{{printf "$%.2f" .OpeningBid}}</td>
          <td data-align="right">{{printf "$%.2f" .MinBidIncr}}</td>
          <td data-align="center">
            <details>
              <summary>{{len .Bids}}</summary>
            </details>
          </td>
        </tr>

        <tr class="bids">
          <td colspan="5">
            <table>
              <thead>
                <tr>
                  <th>Placed</th>
                  <th data-align="right">Amount</th>
                  <th>Bidder</th>
                  {{if $.User.IsAdmin}}
                  <th>Full Name</th>
                  <th>Email</th>
                  {{end}}
                </tr>
              </thead>
              <tbody>
              {{range .Bids}}
                <tr>
                  <td>{{(ToTimeZone .Created "America/Chicago").Format "01/02/06 03:04 pm MST"}}</td>
                  <td  data-align="right">${{printf "%.2f" .Amount}}</td>
                  <td>{{.Bidder}}</td>
                  {{if $.User.IsAdmin}}
                  <td>{{.FullName}}</td>
                  <td>{{.Email}}</td>
                  {{end}}
                </tr>
              {{end}}
              </tbody>
          </table>
        </td>
      </tr>
      </tbody>
      {{end}}
    </table>
    {{else}}
    <p>You must <a href="/login?r=/bids">Login</a> to view bids.</p>
    {{end}}
  </main>
</body>

</html>
