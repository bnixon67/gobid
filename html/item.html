<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <title>{{.Title}} - Item {{.Item.ID}}</title>
  <link rel="stylesheet" href="/pico.min.css">
  <link rel="stylesheet" href="/gobid.css">
</head>

<body>
  <header class="container with-line">
    <nav aria-label="Primary Navigation">
      <ul>
        <li><strong>{{.Title}}</strong></li>
      </ul>
      <ul>
        <li><a href="/gallery">Gallery</a></li>
        <li><a href="/item/{{.Item.ID}}" aria-current="page">Refresh</a></li>
        {{if .User.IsAdmin}}
        <li><a href="/edit/{{.Item.ID}}">Edit</a></li>
        {{end}}
        {{if .User.Username}}
        <li><a href="/logout">Logout</a></li>
        {{else}}
        <li><a href="/login">Login</a></li>
        {{end}}
      </ul>
    </nav>
  </header>

  <main class="container">

    <div class="grid">

      <div>
        <img
          src="/images/{{.Item.ImageFileName}}"
          alt="{{.Item.Title}} by {{.Item.Artist}}"
          style="max-height: 60vh;"
        >
      </div>

      <div>
        <h1>{{.Item.Title}}</h1>
        <h2>{{.Item.Artist}}</h2>
        <p>{{.Item.Description}}</p>

        <div>
        {{ if eq .Item.OpeningBid 0.0 }}
          <div>This item is display only.</div>
        {{ else }}
          <div>
            Current Price:
            ${{ printf "%.2f" (or .Item.CurrentBid .Item.OpeningBid)}}
          </div>
        {{ end }}
        </div>

        <br>

        <div>
        {{ if eq .Item.OpeningBid 0.0 }}
          {{/* display only */}}
        {{else if not .IsAuctionOpen}}
          <div>Auction Closed</div>
        {{else if not .User.Username}}
          <div>
            Please <a href="/login?r=/item/{{.Item.ID}}">Login</a>
            or <a href="/register">Register</a> to bid.
          </div>
        {{else}}
          <form method="post">
            {{if .Message}}
            <p> <mark>{{ .Message }}</mark> </p>
            {{else}}
            <p>&nbsp;</p>
            {{end}}

            <label for="bidAmount"><strong>Your Bid:</strong></label>
            <input
              placeholder="Enter your Bid Amount"
              id="bidAmount" name="bidAmount"
              value="{{ .Item.MinBid }}"
              type="number" inputmode="numeric"
              min="{{.Item.MinBid}}"
              step="any"
              autofocus
              required
              aria-describedby="bidHelp"
            >
            <small id="bidHelp">Minimum bid: ${{.Item.MinBid}}</small>

            <button type="submit">Place Bid</button>
          </form>
        {{end}}
        </div>

      </div>
    </div>

        {{if and .User.Username .Bids}}
        <br>
        <table class="striped">
          <caption>Bid History</caption>
          <thead>
            <tr>
              <th scope="col">Bidder</th>
              <th scope="col">Amount</th>
              <th scope="col">Placed</th>
            </tr>
          </thead>
          <tbody>
          {{range .Bids}}
            <tr>
              <td>{{.Bidder}}</td>
              <td>${{printf "%.2f" .Amount}}</td>
              <td>{{(ToTimeZone .Created "America/Chicago").Format "01/02/06 03:04 pm MST"}}</td>
            </tr>
          {{end}}
          </tbody>
        </table>
        {{end}}

  </main>
</body>
</html>
