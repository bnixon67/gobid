<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <meta name="description" content="Details and bidding for {{.Item.Title}} by {{.Item.Artist}}">
  <title>{{.Title}} - Item {{.Item.ID}}</title>
  <link rel="stylesheet" href="/pico.min.css">
  <link rel="stylesheet" href="/gobid.css">
</head>

<body>
  <a class="skip-link" href="#main">Skip to main content</a>
  <header class="app-header">
    <nav class="container" aria-label="Primary navigation">
      <ul>
        <li><a href="/"><strong>{{.Title}}</strong></a></li>
      </ul>
      <ul>
        <li><a href="/item/{{.Item.ID}}" aria-current="page">Refresh</a></li>
        {{if .User.IsAdmin}}
        <li><a href="/edit/{{.Item.ID}}">Edit</a></li>
        {{end}}
      </ul>
      <ul>
        {{if .User.Username}}
        <li><a href="/logout">Logout {{.User.Username}}</a></li>
        {{else}}
        <li><a href="/login">Login</a></li>
        {{end}}
      </ul>
    </nav>
  </header>

  <main id="main" tabindex="-1" class="container-fluid">
    <div class="grid">
      <figure>
        <img
          src="/images/{{.Item.ImageFileName}}"
          alt="{{.Item.Title}}{{if .Item.Artist}} by {{.Item.Artist}}{{end}}"
          style="max-height: 60vh;"
        >
        <figcaption class="visually-hidden">{{.Item.Title}} image</figcaption>
      </figure>

      <section>
        <h1>{{.Item.Title}}</h1>
        {{if .Item.Artist}}<h2>{{.Item.Artist}}</h2>{{end}}
        <p>{{.Item.Description}}</p>

        <div>
        {{ if eq .Item.OpeningBid 0.0 }}
          <p><strong>This item is display only.</strong></p>
        {{ else }}
          <p>
            <strong>Current Price:</strong>
            ${{ printf "%.2f" (or .Item.CurrentBid .Item.OpeningBid)}}
          </p>
        {{ end }}
        </div>

        {{ if eq .Item.OpeningBid 0.0 }}
          {{/* Display only: no bidding */}}
        {{else if not .IsAuctionOpen}}
          <p><strong>Auction Closed</strong></p>
        {{else if not .User.Username}}
          <p>
            Please <a href="/login?r=/item/{{.Item.ID}}">Login</a>
            or <a href="/register">Register</a> to bid.
          </p>
        {{else}}
          <form method="post">
          {{if .Message}}
            <p class="message" role="status">{{.Message}}</p>
          {{else}}
            <p>&nbsp;</p>
          {{end}}

            <label for="bidAmount"><strong>Your Bid:</strong></label>
            <input
              id="bidAmount" name="bidAmount"
              value="{{ .Item.MinBid }}"
              type="number" inputmode="numeric"
              min="{{.Item.MinBid}}"
              step="any"
              required
              autofocus
              aria-describedby="bidHelp"
            >
            <small id="bidHelp">Minimum bid: ${{.Item.MinBid}}</small>

            <button type="submit">Place Bid</button>
          </form>
        {{end}}
      </section>
    </div>

    {{if and .User.Username .Bids}}
    <section>
      <h2 class="text-center">Bid History</h2>
        <table class="striped">
          <caption class="visually-hidden">
            Bid history for {{.Item.Title}}
          </caption>
          <thead>
            <tr>
              <th scope="col">Bidder</th>
              <th scope="col">Amount</th>
              <th scope="col">Placed</th>
            </tr>
          </thead>
          <tbody>
          {{range .Bids}}
            <tr>
              <td>{{.Bidder}}</td>
              <td>${{printf "%.2f" .Amount}}</td>
              <td>{{(ToTimeZone .Created "America/Chicago").Format "01/02/06 03:04 pm MST"}}</td>
            </tr>
          {{end}}
          </tbody>
        </table>
    </section>
    {{end}}
  </main>
</body>

</html>
